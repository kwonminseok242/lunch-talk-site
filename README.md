# 💬 현직자 런치톡 질문 수집 웹사이트

현직자 런치톡을 위한 질문 수집 웹사이트입니다. Streamlit Cloud로 배포하여 누구나 접근할 수 있습니다.

## 📋 목차

- [주요 기능](#-주요-기능)
- [디자인 개선 과정](#-디자인-개선-과정)
- [데이터 저장 방식](#-데이터-저장-방식)
- [설치 및 실행](#-설치-및-실행)
- [사용 방법](#-사용-방법)
- [관리자 페이지](#-관리자-페이지)
- [트러블슈팅](#-트러블슈팅)
- [주요 변경사항](#-주요-변경사항)

---

## ✨ 주요 기능

- ✅ **익명 질문**: 이름 표시 여부를 선택할 수 있습니다 (기본값: 익명)
- ✅ **질문 작성**: `st.form()`을 사용한 안정적인 질문 등록 (입력 중 리런 방지)
- ✅ **질문 검색**: 키워드로 질문 검색
- ✅ **정렬 옵션**: 좋아요 순, 최신순, 작성자순 정렬
- ✅ **좋아요 기능**: 유용한 질문에 좋아요 표시 (중복 방지)
- ✅ **실시간 통계**: 총 질문 수, 좋아요 수, 오늘 조회수 등 통계 확인
- ✅ **어두운 모던 디자인**: Glassmorphism 효과가 적용된 깔끔한 UI
- ✅ **관리자 페이지**: 질문 관리, 통계, 데이터 내보내기 기능
- ✅ **방문자 추적**: 오늘 조회수 및 방문자 통계

---

## 🎨 디자인 개선 과정

### 1단계: 초기 디자인
- 우리은행 블루 컬러 적용
- 기본 카드 레이아웃

### 2단계: Liquid Glass 시도
- 애플 스타일의 유리 효과 시도
- 밝은 파란색 배경 + 반투명 카드
- **문제점**: 구분이 어렵고 글래스 효과가 명확하지 않음

### 3단계: 어두운 모던 디자인
- 어두운 배경 (`#0a0e27` → `#1a1f3a` → `#0f1419`)
- 진짜 글래스 효과 (`backdrop-filter: blur(40px)`)
- 밝은 카드로 명확한 대비
- **개선점**: 구분이 명확해지고 글래스 효과가 실제로 보임

### 4단계: 최종 UX 개선 (현재)
- **타이포그래피 축소**: 제목 크기 70% 축소, 상단 여백 최소화
- **KPI 상단 배치**: 헤더 바로 아래에 통계 표시
- **2열 레이아웃**: 좌측 질문 작성 폼, 우측 질문 목록
- **사이드바 정리**: 필터만 남기고 폼은 본문으로 이동
- **폼 UX 개선**: `st.form()` 사용으로 입력 중 리런 방지
- **빈 상태 UI 개선**: 작고 명확한 안내 메시지
- **CSS 정리**: 라운딩 통일 (12px), 과한 글로우 제거

### 최종 디자인 특징
- **배경**: 어두운 그라데이션 (`#0B1220` → `#111A2E`)
- **카드**: 반투명 글래스 효과 (`rgba(255, 255, 255, 0.08)`)
- **테두리**: 미묘한 테두리 (`rgba(255, 255, 255, 0.12)`)
- **라운딩**: 통일된 12px
- **타이포그래피**: 명확한 계층 구조

---

## 💾 데이터 저장 방식 (영구 저장 보장)

### ⚠️ 재시작 시 데이터 손실 방지

**중요**: Streamlit Cloud에서 재시작 시 데이터가 사라지지 않도록 **3단계 저장 시스템**을 사용합니다.

### 저장 우선순위

앱은 다음 순서로 데이터를 저장합니다:

1. **Google Sheets** (최우선 - 권장)
   - Streamlit Cloud Secrets에 설정이 있으면 자동 사용
   - 워크시트 이름: `questions`
   - 모든 사용자가 같은 데이터를 공유
   - ✅ **재시작 후에도 데이터 유지**

2. **SQLite 데이터베이스** (영구 저장)
   - Google Sheets가 없으면 SQLite 사용
   - 파일 경로: `lunch-talk-questions/questions.db`
   - ✅ **재시작 후에도 데이터 유지**
   - 로컬 환경과 Streamlit Cloud 모두에서 안정적

3. **JSON 파일** (임시 저장 - 마이그레이션용)
   - SQLite가 실패하면 JSON 파일 사용
   - 파일 경로: `lunch-talk-questions/questions.json`
   - ⚠️ **Streamlit Cloud에서 재시작 시 사라질 수 있음**
   - 기존 JSON 데이터는 자동으로 SQLite로 마이그레이션됨

### 현재 저장 상태 확인

앱 실행 후 "ℹ️ 데이터 저장 정보" Expander를 클릭하면:
- 현재 사용 중인 저장 방식 (Google Sheets / SQLite / JSON)
- 데이터베이스/파일 경로 및 존재 여부
- 현재 저장된 질문 수
- **재시작 시 데이터 유지 여부 경고**

### 저장 방식별 특징

| 저장 방식 | 재시작 후 유지 | 권장 환경 | 설정 필요 |
|---------|------------|---------|---------|
| Google Sheets | ✅ 예 | Streamlit Cloud | Secrets 설정 |
| SQLite | ✅ 예 | 모든 환경 | 자동 설정 |
| JSON | ⚠️ 불안정 | 로컬 개발용 | 없음 |

### 자동 마이그레이션

- 기존 JSON 파일의 데이터는 자동으로 SQLite로 마이그레이션됩니다
- Google Sheets에서 로드한 데이터도 SQLite에 자동 백업됩니다
- 데이터 손실 없이 안전하게 전환됩니다

### Google Sheets 연동 설정

자세한 설정 방법은 [`GOOGLE_SHEETS_SETUP.md`](GOOGLE_SHEETS_SETUP.md)를 참고하세요.

---

## 🚀 설치 및 실행

### 로컬에서 실행하기

```bash
# 저장소 클론
git clone https://github.com/YOUR_USERNAME/lunch-talk-questions.git
cd lunch-talk-questions

# 의존성 설치
pip install -r requirements.txt

# 실행
streamlit run app.py
```

### Streamlit Cloud 배포

1. GitHub에 저장소 업로드
2. [Streamlit Cloud](https://share.streamlit.io/) 접속
3. "New app" 클릭 → 저장소 선택
4. Main file path: `app.py`
5. "Deploy" 클릭

자세한 배포 방법은 아래를 참고하세요.

---

## 📋 사용 방법

### 질문 작성하기

1. 왼쪽 폼에서 질문 작성
2. **이름 표시 여부 선택**:
   - 체크 해제 (기본값): 익명으로 질문 등록
   - 체크: 이름을 입력하여 질문 등록
3. 질문 내용 입력 (최대 1000자)
4. "✅ 질문 등록하기" 버튼 클릭
5. 성공 메시지 확인 후 폼 자동 초기화

### 질문 확인하기

1. 오른쪽 목록에서 등록된 모든 질문 확인
2. **검색 기능**: 상단 검색창에서 키워드로 검색
3. **정렬 옵션**: 드롭다운에서 좋아요 순, 최신순, 작성자순 선택
4. **좋아요 표시**: 각 질문의 "👍 좋아요" 버튼 클릭 (한 번만 가능)

### 사이드바 필터

- 검색: 키워드로 질문 검색
- 정렬 기준: 라디오 버튼으로 정렬 선택

---

## 🔐 관리자 페이지

사이드바의 **"🔐 관리자"** Expander를 클릭하여 접속할 수 있습니다.

**기본 비밀번호**: `woori2024`

### 관리자 페이지 기능

1. **📋 질문 관리**
   - 모든 질문 목록 확인
   - 질문 검색 및 필터링
   - 개별 질문 삭제 (2단계 확인)

2. **📊 통계**
   - 총 질문 수, 좋아요 수 등 통계
   - 작성자별 통계
   - 시간대별 질문 수 차트
   - 방문자 통계 (오늘 방문자, 총 방문 등)

3. **📥 데이터 내보내기**
   - CSV 파일로 내보내기
   - Excel 파일로 내보내기
   - 데이터 미리보기

4. **⚙️ 설정**
   - 데이터 저장 상태 확인
   - 전체 데이터 삭제 (주의!)

### 비밀번호 변경

Streamlit Cloud Secrets에서 비밀번호를 변경할 수 있습니다:

```toml
admin_password = "새로운_비밀번호"
```

---

## 🔧 트러블슈팅

### 0. 재시작 시 데이터가 사라지는 문제

**문제**: Streamlit Cloud에서 앱이 재시작되면 JSON 파일에 저장된 데이터가 사라짐

**원인**: 
- Streamlit Cloud는 임시 파일 시스템을 사용
- JSON 파일은 재시작 시 삭제될 수 있음

**해결**:
- **SQLite 데이터베이스 추가**: 영구 저장을 위한 SQLite 사용
- **3단계 저장 시스템**: Google Sheets → SQLite → JSON 순서로 저장
- Google Sheets가 없어도 SQLite로 데이터가 영구 저장됨
- 기존 JSON 데이터는 자동으로 SQLite로 마이그레이션됨

**상태**: ✅ 해결됨

---

### 1. 질문 등록 후 관리자 페이지에서 보이지 않음

**문제**: 메인 페이지에서 질문을 등록했는데 관리자 페이지에서 보이지 않음

**원인**: 
- 메인 페이지(`app.py`)와 관리자 페이지(`pages/admin.py`)가 서로 다른 파일 경로를 참조
- `app.py`: `"questions.json"` (상대 경로)
- `admin.py`: `"../questions.json"` + `Path(__file__).parent.parent`

**해결**:
```python
# 두 파일 모두 동일한 방식으로 경로 계산
# app.py
DATA_FILE = Path(__file__).parent / "questions.json"

# pages/admin.py
DATA_FILE = Path(__file__).parent.parent / "questions.json"
```

**상태**: ✅ 해결됨

---

### 2. KPI 숫자만 표시되고 레이블이 보이지 않음

**문제**: 상단에 "0 0" 같은 숫자만 표시되고 의미를 알 수 없음

**원인**: 
- KPI를 헤더 옆에 배치하면서 레이블이 제대로 렌더링되지 않음
- `st.metric()`의 레이블이 화면에 표시되지 않음

**해결**:
- KPI를 헤더 아래로 이동
- HTML로 직접 구성하여 레이블과 숫자를 명확히 표시
- 박스로 구역을 나누어 시각적으로 구분

**상태**: ✅ 해결됨

---

### 3. "현재 접속 중" 표시가 부정확함

**문제**: "현재 접속 중"이라고 표시되지만 실제로는 그렇지 않음

**원인**:
- Streamlit은 서버 사이드 렌더링이므로 실제 웹소켓 연결을 추적하기 어려움
- 현재 로직은 "최근 5분 이내 조회한 사용자 수"를 계산
- 실제 "현재 접속 중"과는 다름

**해결**:
- "현재 접속 중" → "오늘 조회수"로 변경
- `total_visits` (오늘 총 조회수)를 표시하도록 수정

**상태**: ✅ 해결됨

---

### 4. 디자인이 구분이 어렵고 글래스 같지 않음

**문제**: 
- 밝은 파란색 배경에 밝은 카드가 배치되어 구분이 어려움
- Liquid Glass 효과가 실제로 보이지 않음

**해결**:
- 어두운 배경 (`#0B1220`)으로 변경
- 카드 배경 대비 증가 (`rgba(255, 255, 255, 0.08)`)
- `backdrop-filter: blur(40px)` 적용
- 명확한 테두리 추가

**상태**: ✅ 해결됨

---

### 5. 타이틀과 숫자가 이상하게 배치됨

**문제**: 타이틀과 KPI 숫자가 한 줄에 배치되어 레이아웃이 어색함

**해결**:
- 타이틀을 별도 박스로 분리
- KPI를 별도 박스로 분리
- 각각 명확한 구역으로 나누어 배치

**상태**: ✅ 해결됨

---

### 6. 입력할 때마다 페이지가 리런됨

**문제**: 질문 작성 폼에서 입력할 때마다 페이지가 새로고침되어 불편함

**해결**:
- `st.form()`으로 폼을 감싸서 제출 전까지 리런 방지
- 제출 시에만 리런되도록 변경

**상태**: ✅ 해결됨

---

### 7. 사이드바가 과밀함

**문제**: 사이드바에 페이지 네비게이션, 폼, 관리자 링크가 모두 있어 복잡함

**해결**:
- 질문 작성 폼을 본문 좌측으로 이동
- 사이드바는 필터와 정렬만 남김
- 관리자 링크는 Expander로 축소

**상태**: ✅ 해결됨

---

## 📝 주요 변경사항

### v1.0 - 초기 버전
- 기본 질문 작성 및 표시 기능
- 우리은행 블루 디자인

### v2.0 - Liquid Glass 디자인 시도
- 애플 스타일 유리 효과 시도
- 그라데이션 배경 애니메이션
- **문제**: 구분이 어렵고 글래스 효과가 명확하지 않음

### v3.0 - 어두운 모던 디자인
- 어두운 배경 적용
- 진짜 글래스 효과 (`backdrop-filter: blur(40px)`)
- 명확한 대비로 구분 개선

### v4.0 - UX 개선
- 타이포그래피 축소 및 여백 최소화
- KPI 상단 배치
- 2열 레이아웃 (폼/목록 분리)
- `st.form()` 적용으로 폼 UX 개선
- 사이드바 정리
- 빈 상태 UI 개선
- CSS 정리 (라운딩 통일, 글로우 제거)
- 파일 경로 통일로 데이터 동기화 문제 해결
- "현재 접속" → "오늘 조회수"로 변경

### v5.0 - 데이터 영구 저장 (현재)
- **SQLite 데이터베이스 추가**: 재시작 후에도 데이터 유지
- **3단계 저장 시스템**: Google Sheets → SQLite → JSON
- **자동 마이그레이션**: 기존 JSON 데이터를 SQLite로 자동 전환
- **저장 상태 경고**: JSON 사용 시 재시작 위험 경고 표시
- 타이포그래피 축소 및 여백 최소화
- KPI 상단 배치
- 2열 레이아웃 (폼/목록 분리)
- `st.form()` 적용으로 폼 UX 개선
- 사이드바 정리
- 빈 상태 UI 개선
- CSS 정리 (라운딩 통일, 글로우 제거)
- 파일 경로 통일로 데이터 동기화 문제 해결
- "현재 접속" → "오늘 조회수"로 변경

---

## 📁 파일 구조

```
lunch-talk-questions/
├── app.py                      # Streamlit 메인 애플리케이션
├── pages/
│   └── admin.py               # 관리자 페이지
├── utils_stats.py             # 방문자 추적 유틸리티
├── requirements.txt            # Python 의존성
├── requirements_minimal.txt    # 최소 의존성 (Google Sheets 없이)
├── .streamlit/
│   ├── config.toml            # Streamlit 테마 설정
│   └── secrets.toml.example   # Secrets 예시 파일
├── questions.json             # 질문 데이터 (임시, SQLite로 마이그레이션됨)
├── questions.db               # SQLite 데이터베이스 (영구 저장)
├── stats.json                 # 통계 데이터 (자동 생성)
├── README.md                  # 이 파일
├── GOOGLE_SHEETS_SETUP.md     # Google Sheets 연동 가이드
├── DATA_STORAGE.md            # 데이터 저장 상세 설명
└── DEPLOYMENT_FIX.md          # 배포 문제 해결 가이드
```

---

## 🛠️ 기술 스택

- **프레임워크**: Streamlit
- **언어**: Python 3.x
- **데이터 저장**: 
  - Google Sheets (선택)
  - JSON 파일 (로컬)
- **스타일링**: CSS (Glassmorphism)
- **통계**: pandas, openpyxl

---

## 📦 의존성

### 필수
- `streamlit>=1.28.0`
- `pandas>=2.0.0`
- `openpyxl>=3.1.0` (Excel 내보내기용)

### 선택 (Google Sheets 연동)
- `st-gsheets-connection`

설치:
```bash
pip install -r requirements.txt
```

Google Sheets 없이 사용:
```bash
pip install -r requirements_minimal.txt
```

---

## 💡 사용 팁

1. **익명 질문**: 이름을 표시하지 않고 싶다면 체크박스를 해제하세요
2. **검색 기능**: 많은 질문이 있을 때 키워드로 빠르게 찾을 수 있습니다
3. **정렬 기능**: 좋아요가 많은 질문을 먼저 보고 싶다면 "좋아요 순" 선택
4. **폼 사용**: 입력 중에는 페이지가 리런되지 않으니 편하게 작성하세요
5. **관리자 기능**: 질문을 정리하거나 통계를 확인하려면 관리자 페이지 이용
6. **데이터 확인**: "ℹ️ 데이터 저장 정보"에서 현재 저장 방식을 확인할 수 있습니다

---

## 🔍 디버깅

### 데이터 저장 상태 확인

앱 실행 후 "ℹ️ 데이터 저장 정보" Expander를 클릭하면:
- 현재 사용 중인 저장 방식 (Google Sheets / 로컬 파일)
- 파일 경로 및 존재 여부
- 저장된 질문 수

### 로그 확인

Streamlit Cloud에서:
1. 앱 대시보드 접속
2. "Manage app" 클릭
3. "Logs" 탭에서 에러 확인

### 일반적인 문제

1. **질문이 저장되지 않음**
   - 파일 권한 확인
   - Google Sheets 설정 확인 (Secrets)
   - 로그에서 에러 메시지 확인

2. **관리자 페이지에서 질문이 보이지 않음**
   - 파일 경로 확인 (위 트러블슈팅 참고)
   - 데이터 저장 방식 확인

3. **Google Sheets 연동 실패**
   - Secrets 설정 확인
   - 스프레드시트 공유 설정 확인
   - `GOOGLE_SHEETS_SETUP.md` 참고

---

## 🧪 테스트 가이드

자세한 테스트 방법은 [`TESTING_GUIDE.md`](TESTING_GUIDE.md)를 참고하세요.

### 빠른 테스트

```bash
# 1. 앱 실행
streamlit run app.py

# 2. 질문 등록 테스트
# - 브라우저에서 질문 작성 및 등록
# - 오른쪽 목록에서 확인

# 3. 재시작 테스트
# - 터미널에서 Ctrl+C로 중지
# - streamlit run app.py로 재시작
# - 질문이 유지되는지 확인

# 4. SQLite 확인 (선택사항)
sqlite3 questions.db "SELECT * FROM questions;"
```

---

## 📄 라이선스

이 프로젝트는 우리은행 FISA 부트캠프 교육용으로 제작되었습니다.

---

## 👥 기여

버그 리포트나 기능 제안은 GitHub Issues를 이용해주세요.

---

**우리은행 FISA 부트캠프** 💙
